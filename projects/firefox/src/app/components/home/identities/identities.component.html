<!-- eslint-disable @angular-eslint/template/interactive-supports-focus -->
<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<div class="custom-header" style="position: sticky; top: 0">
  <div class="header-buttons">
    <button class="header-btn" title="Lock" (click)="onClickLock()">
      <span class="emoji">ğŸ”’</span>
    </button>
    @if (devMode) {
      <button class="header-btn" title="Test Permission Prompt" (click)="onTestPrompt()">
        <span class="emoji">âœ¨</span>
      </button>
    }
  </div>
  <span class="text">Identities</span>

  <button class="add-btn" title="New Identity" (click)="onClickNewIdentity()">
    <span class="emoji">â•</span>
  </button>
</div>

<div class="reckless-mode-row">
  <label class="reckless-label" (click)="onToggleRecklessMode()">
    <input
      type="checkbox"
      [checked]="isRecklessMode"
      (click)="$event.stopPropagation()"
      (change)="onToggleRecklessMode()"
    />
    <span
      class="reckless-text"
      data-bs-toggle="tooltip"
      data-bs-placement="bottom"
      title="Auto-approve all actions. If whitelist has entries, only those apps are auto-approved."
    >Reckless mode</span>
  </label>
  <button
    class="gear-btn"
    title="Manage whitelisted apps"
    (click)="onClickWhitelistedApps()"
  >
    <span class="emoji">âš™ï¸</span>
  </button>
</div>

@let sessionData = storage.getBrowserSessionHandler().browserSessionData;
@let identities = sessionData?.identities ?? [];

@if(identities.length === 0) {
<div class="empty-state">
  <span class="sam-text-muted">
    Create your first identity by clicking on the button in the upper right
    corner.
  </span>
</div>
}

@for(identity of identities; track identity.id) {
  @let isSelected = identity.id === sessionData?.selectedIdentityId;
  <div
    class="identity"
    [class.selected]="isSelected"
    (click)="onClickSelectIdentity(identity.id)"
  >
    <img
      class="avatar"
      [src]="getAvatarUrl(identity)"
      alt=""
      (error)="$any($event.target).src = 'person-fill.svg'"
    />
    <span class="name">{{ getDisplayName(identity) }}</span>
    <lib-icon-button
      icon="âš™ï¸"
      title="Identity settings"
      (click)="onClickEditIdentity(identity.id, $event)"
    ></lib-icon-button>
  </div>
}

<lib-toast #toast></lib-toast>
